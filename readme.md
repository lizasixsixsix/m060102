# 06 SQL basics

## общее

Для работы мы будем использовать базу Northwind, исходный код которой
можно найти в материалах, в файле _instnwnd.sql_.

Результаты [задания 01](#01-отработка-SQL-запросов-на-поиск-и-фильтрацию)
и [задания 02](#02-отработка-SQL-запросов-на-объединение-таблиц-и-агрегацию)
можно оформить или отдельными SQL-скриптами,
или добавить их в SSDT проект, который создать из файла _instnwnd.sql_
(только не забывайте, что такие скрипты
не нужно включать в компиляцию проекта).

## 01 отработка SQL-запросов на поиск и фильтрацию

### 01 простая фильтрация данных

#### 01

Выбрать в таблице `Orders` заказы, которые были доставлены
после 6 мая 1998 года (колонка `ShippedDate`) включительно
и которые доставлены с `ShipVia >= 2`.

Запрос должен возвращать только колонки `OrderID`, `ShippedDate` и `ShipVia`.

#### 02

Написать запрос, который выводит только недоставленные заказы
из таблицы `Orders`.

В результатах запроса возвращать для колонки `ShippedDate`
вместо значений `NULL` строку `'Not Shipped'`
(использовать системную функцию `CASЕ`).

Запрос должен возвращать только колонки `OrderID` и `ShippedDate`.

#### 03

Выбрать в таблице `Orders` заказы, которые были доставлены
после 6 мая 1998 года (`ShippedDate`), не включая эту дату,
или которые ещЁ не доставлены.

В запросе должны возвращаться только колонки `OrderID`
(переименовать в `Order Number`)
и `ShippedDate` (переименовать в `Shipped Date`).

В результатах запроса возвращать для колонки `ShippedDate`
вместо значений `NULL` строку `'Not Shipped'`,
для остальных значений возвращать дату в формате по умолчанию.

### 02 использование операторов `IN`, `DISTINCT`, `ORDER BY`, `NOT`

#### 01

Выбрать из таблицы `Customers` всех заказчиков, проживающих в USA и Canada.

Запрос сделать с помощью только оператора `IN`.

Возвращать колонки с именем пользователя и названием страны
в результатах запроса.

Упорядочить результаты запроса по имени заказчиков и по месту проживания.

#### 02

Выбрать из таблицы `Customers` всех заказчиков, не проживающих в USA и Canada.

Запрос сделать с помощью оператора `IN`.

Возвращать колонки с именем пользователя и названием страны
в результатах запроса.

Упорядочить результаты запроса по имени заказчиков.

#### 03

Выбрать из таблицы `Customers` все страны, в которых проживают заказчики.

Страна должна быть упомянута только один раз и список отсортирован по убыванию.

Не использовать предложение `GROUP BY`.

Возвращать только одну колонку в результатах запроса.

### 03 использование оператора `BETWEEN`, `DISTINCT`

#### 01

Выбрать все заказы (`OrderID`) из таблицы `Order Details`
(заказы не должны повторяться),
где встречаются продукты с количеством от 3 до 10 включительно &mdash;
это колонка `Quantity` в таблице `Order Details`.

Использовать оператор `BETWEEN`.

Запрос должен возвращать только колонку `OrderID`.

#### 02

Выбрать всех заказчиков из таблицы `Customers`,
у которых название страны начинается на буквы из диапазона _b_ и _g_.

Использовать оператор `BETWEEN`.

Проверить, что в результаты запроса попадает _Germany_.

Запрос должен возвращать только колонки `CustomerID` и `Country`
и отсортирован по `Country`.

#### 03

Выбрать всех заказчиков из таблицы `Customers`,
у которых название страны начинается на буквы из диапазона _b_ и _g_,
не используя оператор `BETWEEN`.

### 04 использование оператора `LIKE`

#### 01

В таблице `Products` найти все продукты (колонка `ProductName`),
где встречается подстрока `'chocolade'`.

Известно, что в подстроке `'chocolade'` может быть изменена
одна буква `'c'` в середине &mdash; найти все продукты,
которые удовлетворяют этому условию.

## 02 отработка SQL-запросов на объединение таблиц и агрегацию

### 01 использование агрегатных функций (`SUM`, `COUNT`)

#### 01

Найти общую сумму всех заказов из таблицы `Order Details`
с учётом количества закупленных товаров и скидок по ним.

Результатом запроса должна быть одна запись с одной колонкой
с названием колонки `'Totals'`.

#### 02

По таблице `Orders` найти количество заказов,
которые ещё не были доставлены
(т.е. в колонке `ShippedDate` нет значения даты доставки).

Использовать при этом запросе только оператор `COUNT`.

Не использовать предложения `WHERE` и `GROUP`.

#### 03

По таблице `Orders` найти количество различных покупателей (`CustomerID`),
сделавших заказы.

Использовать функцию `COUNT` и не использовать предложения `WHERE` и `GROUP`.

### 02 соединение таблиц, использование агрегатных функций
       и предложений `GROUP BY` и `HAVING`

#### 01

По таблице `Orders` найти количество заказов с группировкой по годам.

В результатах запроса надо возвращать две колонки
c названиями `Year` и `Total`.

Написать проверочный запрос, который вычисляет количество всех заказов.

#### 02

По таблице `Orders` найти количество заказов, cделанных каждым продавцом.

Заказ для указанного продавца &mdash; это любая запись в таблице `Orders`,
где в колонке `EmployeeID` задано значение для данного продавца.

В результатах запроса надо возвращать колонку с именем продавца
(должно высвечиваться имя, полученное конкатенацией `LastName` & `FirstName`.

Эта строка _LastName & FirstName_ должна быть получена отдельным запросом
в колонке основного запроса.

Также основной запрос должен использовать группировку по `EmployeeID`)
с названием колонки `'Seller'`
и колонку c количеством заказов возвращать с названием `'Amount'`.

Результаты запроса должны быть упорядочены по убыванию количества заказов.

#### 03

По таблице `Orders` найти количество заказов,
сделанных каждым продавцом и для каждого покупателя.

Необходимо определить это только для заказов, сделанных в 1998 году.

#### 04

Найти покупателей и продавцов, которые живут в одном городе.

Если в городе живут только один или несколько продавцов
или только один или несколько покупателей,
то информация о таких покупателя и продавцах
не должна попадать в результирующий набор.

Не использовать конструкцию `JOIN`.

#### 05

Найти всех покупателей, которые живут в одном городе.

#### 06

По таблице `Employees` найти для каждого продавца его руководителя.

### 03 использование `JOIN`

#### 01

Определить продавцов,
которые обслуживают регион `'Western'` (таблица `Region`).

#### 02

Выдать в результатах запроса имена всех заказчиков из таблицы `Customers`
и суммарное количество их заказов из таблицы `Orders`.

Принять во внимание, что у некоторых заказчиков нет заказов,
но они также должны быть выведены в результатах запроса.

Упорядочить результаты запроса по возрастанию количества заказов.

### 04 использование подзапросов

#### 01

Выдать всех поставщиков (колонка `CompanyName` в таблице `Suppliers`),
у которых нет хотя бы одного продукта на складе
(`UnitsInStock` в таблице `Products` равно 0).

Использовать для этого запроса вложенный `SELECT`
с использованием оператора `IN`.

#### 02

Выдать всех продавцов, которые имеют более 150 заказов.

Использовать вложенный `SELECT`.

#### 03

Выдать всех заказчиков (таблица `Customers`),
которые не имеют ни одного заказа (подзапрос по таблице `Orders`).

Использовать оператор `EXISTS`.